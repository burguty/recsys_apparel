# Recommendation System for Apparel Dataset

## Описание решения

В рамках хакатона была разработана система рекомендаций для товаров для категории apparel (одежда, обувь, аксессуары).  
Система объединяет методы обработки пользовательских логов, машинного обучения (логистическая регрессия и ALS) и деревьев категорий для отбора релевантных кандидатов.

---

## Структура пайплайна

### 1. Обработка таблицы логов
- Чтение сырых данных (orders и tracker).
- Кодирование действий пользователей (`view_description`, to_cart, page_view, favorite, unfavorite, review_view, `remove`).
- Присвоение статуса заказа (`delivered_orders` / `canceled_orders`).
- Агрегация данных по пользователям и товарам.
- Результат сохраняется в agg_interactions/ и далее объединяется в таблицу interactions/.

### 2. Нахождение весов для рейтингов
- Признаки: количество взаимодействий каждого типа.
- Модель: LogisticRegression (scikit-learn).
- Целевая переменная: last_status (доставлен/отменён).
- Получаем коэффициенты для линейной комбинации действий, которые используются как веса.

### 3. Генерация матрицы R
- Строим матрицу взаимодействий R[user, item], где значение — линейная комбинация действий пользователя с товаром.
- Сохраняем в разреженном формате .npz для эффективного хранения.

### 4. Обучение ALS
- Используем библиотеку implicit.
- Параметры: количество факторов (200), регуляризация (0.05), число итераций (50).
- На выходе получаем эмбеддинги пользователей и товаров.

### 5. Отбор кандидатов
- Строим дерево категорий (`CategoryTree`).
- Для каждого пользователя:
  - Берём топ-40% товаров по рейтингу.
  - Суммируем рейтинги по категориям.
  - Отбираем топ-50 категорий.
  - Расширяем список категорий ближайшими "братьями или сёстрами" из дерева.
  - Аналогично находим бренды (без учёта "Нет бренда").

### 6. Предсказания
- Для каждого пользователя:
  - Отбираем кандидатов-товаров на основе релевантных категорий и брендов.
  - Вычисляем скалярное произведение эмбеддингов (ALS).
  - Формируем топ-100 рекомендаций.

### 7. Финальный submission
- Декодируем индексы пользователей и товаров.
- Формируем CSV с колонками:
  - user_id
  - item_id_1 item_id_2 ... item_id_100

---

## Используемые технологии

- Polars — высокопроизводительная работа с табличными данными.
- scikit-learn — логистическая регрессия, метрики.
- implicit — ALS-модель для матричной факторизации.
- joblib — сериализация энкодеров и моделей.
- pandas / numpy — подготовка данных и финальные преобразования.
- tqdm — прогресс-бары.

---

## Структура данных

- orders — информация о заказах (user_id, item_id, status).
- tracker — логи действий пользователей.
- items — справочник товаров с категориями и брендами.
- categories_tree — иерархия категорий.

---

## Как запустить

**Подразумевается, что все необходимые данные лежат в каталоге `./data`**

1. source ./launch.sh
2. Запускаем ячейки solution.ipynb

---

## Примечание

Дополнительный код, который пригодился для хакатона, лежит в каталоге `./auxiliary` (в том числе промежуточные вычисления, но только небольшие по памяти)
